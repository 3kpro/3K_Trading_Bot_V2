<!DOCTYPE html>
<html>
<head>
    <title>3K Trading Bot Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h1>3K Trading Bot Dashboard</h1>
<p><strong>Status:</strong> <span id="bot_status" style="color: #00ffcc;">ACTIVE</span> | <strong>Current Time:</strong> <span id="current_time"></span></p>

<div class="card">
    <h2>Live Status</h2>
    <p><strong>Symbol:</strong> <span id="symbol"></span></p>
    <p><strong>Last Price:</strong> $<span id="price"></span></p>
    <p><strong>Signal:</strong> <span id="signal" class="signal"></span> <span title="Current trading signal: long (buy), short (sell), or none">(?)</span></p>
    <p><strong>Equity:</strong> $<span id="equity"></span></p>
    <p><strong>RSI:</strong> <span id="rsi"></span> <span title="Relative Strength Index - momentum indicator">(?)</span></p>
    <p><strong>ATR:</strong> <span id="atr"></span> <span title="Average True Range - volatility measure">(?)</span></p>
    <p><strong>Donchian Upper:</strong> $<span id="donchian_upper"></span></p>
    <p><strong>Donchian Lower:</strong> $<span id="donchian_lower"></span></p>
    <p><small>Last Update: <span id="last_update"></span></small></p>
</div>

<div class="card">
    <h2>Warmup Status</h2>
    <div class="progress">
        <div id="progress-bar"></div>
    </div>
    <p id="ready-text"></p>
    <p><small>Bot scans for signals every 10 seconds</small></p>
</div>

<div class="card">
    <h2>Equity Curve</h2>
    <canvas id="equityChart"></canvas>
</div>

<div class="card">
    <h2>How It Works</h2>
    <p><strong>Strategy:</strong> Donchian Channel Breakout with ATR stops and RSI filter.</p>
    <p><strong>Entry:</strong> Buy when price breaks above upper channel, sell when below lower (RSI 35-70).</p>
    <p><strong>Exit:</strong> Stop loss at 2x ATR from entry price.</p>
    <p><strong>Risk:</strong> 0.5% of equity per trade.</p>
    <p><small>This is paper trading - no real money at risk.</small></p>
</div>

<script>
let chart;

function fetchState() {
    fetch("/state")
        .then(r => r.json())
        .then(data => {
            document.getElementById("symbol").innerText = data.symbol;
            document.getElementById("price").innerText = data.last_price.toFixed(2);
            let signalEl = document.getElementById("signal");
            signalEl.innerText = data.signal || "None";
            signalEl.className = "signal " + (data.signal === "long" ? "long" : data.signal === "short" ? "short" : "");
            document.getElementById("equity").innerText = data.equity.toFixed(2);
            document.getElementById("rsi").innerText = data.rsi.toFixed(2);
            document.getElementById("atr").innerText = data.atr.toFixed(4);
            document.getElementById("donchian_upper").innerText = data.donchian_upper.toFixed(2);
            document.getElementById("donchian_lower").innerText = data.donchian_lower.toFixed(2);
            document.getElementById("last_update").innerText = new Date(data.last_update).toLocaleTimeString();

            // progress bar
            let pct = data.warmup_progress * 100;
            document.getElementById("progress-bar").style.width = pct + "%";
            document.getElementById("ready-text").innerText =
                data.ready ? "READY TO TRADE" : "WARMING UP...";

            // animate progress if not ready
            if (!data.ready) {
                document.getElementById("progress-bar").style.animation = "pulse 1s infinite";
            } else {
                document.getElementById("progress-bar").style.animation = "";
            }

            // update chart
            if (chart) {
                chart.data.labels = data.equity_history.map((_, i) => i);
                chart.data.datasets[0].data = data.equity_history;
                chart.update();
            }
        });
}

function initChart() {
    let ctx = document.getElementById("equityChart").getContext("2d");
    chart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [],
            datasets: [{
                label: "Equity",
                borderColor: "#00ffcc",
                backgroundColor: "rgba(0,255,200,0.1)",
                data: []
            }]
        },
        options: {
            responsive: true,
            animation: { duration: 300 }
        }
    });
}

initChart();
setInterval(fetchState, 2000);
setInterval(updateTime, 1000);
updateTime(); // initial call

function updateTime() {
    document.getElementById("current_time").innerText = new Date().toLocaleTimeString();
}
</script>

</body>
</html>